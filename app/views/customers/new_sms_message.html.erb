<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6">
        <h1 class="m-0 text-dark"><%= t('common.sms_notify') %></h1>
      </div>

      <div class="col-sm-6">
        <ol class="breadcrumb float-sm-right">
          <li class="breadcrumb-item"><a href="<%= homes_path %>"><%= t('common.home') %></a></li>
          <li class="breadcrumb-item"><a href="<%= customers_path %>"><%= t('common.customer_index') %></a></li>
          <li class="breadcrumb-item"><a href="<%= customer_path(@company.code, @customer) %>"><%= t('common.customer_show') %></a></li>
          <li class="breadcrumb-item active"><%= t('common.sms_notify') %></li>
        </ol>
      </div>
    </div>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">TO: <%= @customer.name %> <%= t('common.honorifics') %></h3>
      </div>

      <div class="card-body pt-1 pl-1 pr-1 pb-0">
        <div class="row">
          <div class="col-md-6">
            <div class="card card-primary direct-chat direct-chat-default">
              <div class="card-body">
                <div class="direct-chat-messages" style="height: 320px;">
                  <table class="table table-bordered">
                    <tbody>
                      <% if @company.is_input_customer_name? %>
                        <tr>
                          <th class="text-nowrap"><%= Customer.human_attribute_name(:name) %></th>
                          <td><%= @customer.name.to_s %>（<%= @customer.name_kana.to_s %>）</td>
                        </tr>
                      <% end %>

                      <% if @company.is_input_customer_name_kana? %>
                        <tr>
                          <th class="text-nowrap"><%= Customer.human_attribute_name(:gender) %></th>
                          <td><%= Customer.human_attribute_name("gender.#{ @customer.gender }") %></td>
                        </tr>
                      <% end %>

                      <% if @company.is_input_customer_tel_number? %>
                        <tr>
                          <th class="text-nowrap"><%= Customer.human_attribute_name(:tel_number) %></th>
                          <td><%= @customer.formatted_tel_number.to_s %></td>
                        </tr>
                      <% end %>

                      <% if @company.is_input_customer_birthday? %>
                        <tr>
                          <th class="text-nowrap"><%= Customer.human_attribute_name(:birthday) %></th>
                          <td><%= @customer.birthday.strftime("%Y年%m月%d日") if @customer.birthday %></td>
                        </tr>
                      <% end %>

                      <% if @company.is_input_customer_address? %>
                        <tr>
                          <th class="text-nowrap"><%= Customer.human_attribute_name(:address) %></th>
                          <td><%= @customer.all_address  %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card card-primary direct-chat direct-chat-default">
              <div class="card-body">
                <div id="message-log" class="direct-chat-messages" style="height: 320px;">
                  <% @sms_logs.each do |sms_log| %>
                    <%= sms_log.message.to_s %>
                  <% end %>
                </div>
              </div>
              <div class="card-footer">
                <small class="float-right"><%= t('common.max_num', max_num: Const::SMS::DISPLAY_LIMIT) %></small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card-footer">
        <%= form_with(model: nil, url: send_sms_message_customer_path(@customer, company_code: @company.code),local: true) do |f| %>

          <div class="form-group">
            <%= f.text_area :message, { class: 'form-control', placeholder: t('common.input_message_prompt'), maxlength: 60, rows: 4, required: true } %>
          </div>

          <%= f.submit class: 'btn btn-primary', value: t('common.submit_button'), data: { disable_with: t('common.submit_disable_with') } %>
        <% end %>
      </div>
    </div>
  </div>
</section>

<%= javascript_tag do %>
  $(function() {
    // メッセージの表示部分を最新のコメントにスクロールする処理
    $("#message-log").scrollTop($("#message-log")[0].scrollHeight);
  });
<% end %>
