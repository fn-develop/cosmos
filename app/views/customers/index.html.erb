<%= render 'content_header', active_breadcrumb_item: Const::View::Name::CUSTOMER_INDEX %>

<section class="content">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">検索</h3>

      <div class="card-tools">
        <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
        </button>
      </div>
    </div>

    <div class="card-body" style="display: block;">
      <%= form_with model: @search, url: customers_path, method: :get, local:true do |f| %>
        <div class="input-group">
          <%= f.text_field :name, { autocomplete: "off", class: 'form-control', placeholder: '名前', maxlength: 20 } %>
          <span class="input-group-append">
            <%= f.button "検索", { class: 'btn btn-info' } %>
          </span>
        </div>
      <% end %>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th style="width: 10px"><%= Customer.human_attribute_name(:id) %></th>
            <th><%= Customer.human_attribute_name(:name) %></th>
            <th><%= Customer.human_attribute_name(:name_kana) %></th>
            <th><%= Customer.human_attribute_name(:gender) %></th>
            <th><%= Customer.human_attribute_name(:tel_number) %></th>
            <th><%= Customer.human_attribute_name(:birthday) %></th>
            <th>LINE通知</th>
          </tr>
        </thead>
        <tbody>

          <% @customers.each_with_index do |customer, i| %>
            <tr>
              <td><a href="<%= customer_path(@company.code, customer) %>"><%= customer.id.to_s %>.</a></td>
              <td><%= customer.name.to_s %></td>
              <td><%= customer.name_kana.to_s %></td>
              <td><%= Customer.human_attribute_name("gender.#{ customer.gender }") if customer.gender %></td>
              <td><%= customer.formatted_tel_number.to_s %></td>
              <td><%= customer.birthday.strftime("%Y年%m月%d日") if customer.birthday %></td>
              <td>
                <% if customer.user.try(:unread_user_line_message?) %>
                  <%= link_to '未読あり', new_line_message_customer_path(@company.code, customer), class: 'btn btn-sm btn-success float-left' %>
                <% end %>
              </td>
            </tr>
          <% end %>

        </tbody>
      </table>

      <%= paginate @customers %>
      <a href="<%= new_customer_path(company_code: @company.code ) %>" class="btn btn-info float-left mt-1">新規作成</a>
    </div>
  </div>
</section>
